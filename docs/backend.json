{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the Staylo application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "createdAt",
        "updatedAt"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel listed on the Staylo platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel."
        },
        "name": {
          "type": "string",
          "description": "Name of the hotel."
        },
        "address": {
          "type": "string",
          "description": "Address of the hotel."
        },
        "city": {
          "type": "string",
          "description": "City where the hotel is located."
        },
        "country": {
          "type": "string",
          "description": "Country where the hotel is located."
        },
        "description": {
          "type": "string",
          "description": "Description of the hotel."
        },
        "rating": {
          "type": "number",
          "description": "Average rating of the hotel (e.g., 4.5)."
        },
        "imageUrls": {
          "type": "array",
          "description": "Array of URLs for images of the hotel.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "List of amenities offered by the hotel.",
          "items": {
            "type": "string"
          }
        },
        "latitude": {
          "type": "number",
          "description": "Latitude coordinate of the hotel's location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude coordinate of the hotel's location."
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "city",
        "country",
        "description",
        "rating",
        "imageUrls",
        "amenities",
        "latitude",
        "longitude"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a user for a hotel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Booking)"
        },
        "hotelId": {
          "type": "string",
          "description": "Reference to Hotel. (Relationship: Hotel 1:N Booking)"
        },
        "checkInDate": {
          "type": "string",
          "description": "Check-in date for the booking.",
          "format": "date-time"
        },
        "checkOutDate": {
          "type": "string",
          "description": "Check-out date for the booking.",
          "format": "date-time"
        },
        "numberOfGuests": {
          "type": "number",
          "description": "Number of guests for the booking."
        },
        "totalPrice": {
          "type": "number",
          "description": "Total price of the booking."
        },
        "bookingDate": {
          "type": "string",
          "description": "Date when the booking was made.",
          "format": "date-time"
        },
        "cancellationPolicy": {
          "type": "string",
          "description": "Cancellation policy applicable to the booking."
        }
      },
      "required": [
        "id",
        "userId",
        "hotelId",
        "checkInDate",
        "checkOutDate",
        "numberOfGuests",
        "totalPrice",
        "bookingDate",
        "cancellationPolicy"
      ]
    },
    "Destination": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Destination",
      "type": "object",
      "description": "Represents a travel destination.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the destination."
        },
        "name": {
          "type": "string",
          "description": "Name of the destination (e.g., Delhi, Mumbai)."
        },
        "description": {
          "type": "string",
          "description": "Description of the destination."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the destination."
        },
        "averageRating": {
          "type": "number",
          "description": "Average rating of the destination based on user reviews."
        },
        "hotelIds": {
          "type": "array",
          "description": "References to Hotels. (Relationship: Destination N:N Hotel)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "averageRating",
        "hotelIds"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (from Firebase Auth)."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel information. Globally readable, admin-editable.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier of the hotel."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for a user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (from Firebase Auth)."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      },
      {
        "path": "/destinations/{destinationId}",
        "definition": {
          "entityName": "Destination",
          "schema": {
            "$ref": "#/backend/entities/Destination"
          },
          "description": "Stores information about travel destinations. Globally readable, admin-editable.",
          "params": [
            {
              "name": "destinationId",
              "description": "The unique identifier of the destination."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to prioritize authorization independence, clarity, and scalability for the Staylo application. It leverages path-based ownership for user profiles and bookings, and a global collection for hotels and destinations. \n\n**Authorization Independence:**\n\n*   User profiles are stored under `/users/{userId}`, ensuring that access control is directly tied to the authenticated user's ID. Bookings are stored under `/users/{userId}/bookings/{bookingId}`, making ownership explicit and rules simple.\n\n*   The absence of `get()` calls in security rules is ensured by avoiding hierarchical authorization dependencies. Instead, each document contains all the necessary information for access control, adhering to Authorization Independence.\n\n**Structural Segregation:**\n\n*   User-specific data (profiles, bookings) is segregated from global data (hotels, destinations). This ensures that different security rules can be applied to each data type without conflicts.\n\n**Access Modeling:**\n\n*   Path-based ownership is used for user profiles and bookings, providing secure and efficient access control. \n\n*   Hotels and Destinations are in a global collection. In this case, hotels are globally read accessible, any admin user can add and edit hotels.\n\n**QAPs (Rules are not Filters):**\n\n*   The separation of user data and global data supports secure `list` operations. Rules can be written to allow users to only list their own profiles or bookings. Global collections can be read by anyone, but only edited by admins. Thus, filtering is never happening at the rule level.\n\n**Invariants:**\n\n*   The structure supports the integrity of ownership by explicitly associating profiles and bookings with user IDs in their respective paths. Timestamps can be enforced using rules to ensure that `createdAt` and `updatedAt` fields are properly set.\n\n**Email Auth and DB Integration:**\n\n*   User profiles are stored in `/users/{userId}`, which is the standard way of integrating Firebase Authentication with Firestore.\n\n**GenAI:**\n\n*   The structure supports the GenAI requirements by providing a clear separation of concerns. The AI can read hotel and destination data, and user's can use the AI to create the destinations."
  }
}